<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>{{ filename }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

  <!-- Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© -->
  <div class="preview">
    <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ Ù„Ù„Ø¹Ù†ÙˆØ§Ù† -->
    <div class="top-header">
      <span class="book-icon">ğŸ“˜</span>
      <span class="book-title">{{ filename.rsplit('.', 1)[0] }}</span>
    </div>

    <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="toolbar">
      <button onclick="copyWithMeta()">ğŸ“‹ Ù†Ø³Ø® </button>
      <button onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
      Ø­Ø¬Ù… Ø§Ù„Ø®Ø·:
      <button onclick="adjustFontSize(1)">+</button>
      <button onclick="adjustFontSize(-1)">âˆ’</button>
    </div>

    <div id="display-area" class="full-display">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØ§Ù„Ø±Ù‚Ù… -->
    <div class="nav-buttons">
      <button id="prev-btn" onclick="prevPage()">â¬…ï¸ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
      <div id="page-number">ğŸ“„ Ø§Ù„ØµÙØ­Ø© 1</div>
      <button id="next-btn" onclick="nextPage()">Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸</button>
    </div>
  </div>

  <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
  <div class="sidebar">
    <h2>ğŸ“š Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒØªØ¨</h2>
    <form method="POST" action="/search">
      <input type="text" name="query" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø¨Ø­Ø«" required>
      <div>
        <label><input type="radio" name="search_mode" value="and" checked> Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª (AND)</label>
        <label><input type="radio" name="search_mode" value="or"> Ø£ÙŠ ÙƒÙ„Ù…Ø© (OR)</label>
      </div>
      <button type="submit">ğŸ” Ø¨Ø­Ø«</button>
    </form>
    <hr>
    {% for folder, fname in books %}
      <a href="{{ url_for('view_book', folder=folder, filename=fname) }}"
         class="{% if folder == current_folder and fname == current_filename %}active-book{% endif %}">
        {{ folder }}/{{ fname.rsplit('.', 1)[0] }}
      </a>
    {% endfor %}
  </div>

  <!-- Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
  <script>
    let currentPages = {{ book_pages | tojson | safe }};
    let currentPageIndex = 0;
    let fontSize = 17;

    function showPage(index) {
      const container = document.getElementById("display-area");
      const number = document.getElementById("page-number");

      if (currentPages.length > 0) {
        container.innerHTML = currentPages[index];
        currentPageIndex = index;

        document.getElementById("prev-btn").disabled = (index === 0);
        document.getElementById("next-btn").disabled = (index === currentPages.length - 1);

        number.innerText = `ğŸ“„ Ø§Ù„ØµÙØ­Ø© ${index + 1}`;
      }
    }

    function nextPage() {
      if (currentPageIndex < currentPages.length - 1) {
        showPage(currentPageIndex + 1);
      }
    }

    function prevPage() {
      if (currentPageIndex > 0) {
        showPage(currentPageIndex - 1);
      }
    }

    function adjustFontSize(change) {
      fontSize += change;
      document.getElementById("display-area").style.fontSize = fontSize + "px";
    }

    function copyWithMeta() {
      const selection = window.getSelection().toString().trim();
      const fullText = currentPages[currentPageIndex];
      const pageInfo = document.getElementById("page-number").innerText;
      const bookTitle = "{{ filename.rsplit('.', 1)[0] }}";

      const textToCopy = selection || fullText;
      const finalText = `${textToCopy}\n\nğŸ“˜ Ø§Ù„ÙƒØªØ§Ø¨: ${bookTitle}\n${pageInfo}`;

      navigator.clipboard.writeText(finalText)
        .then(() => alert("âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¨Ù†Ø¬Ø§Ø­"))
        .catch(() => alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®"));
    }

    window.onload = function () {
      showPage(0);
    }
  </script>

</body>
</html>
